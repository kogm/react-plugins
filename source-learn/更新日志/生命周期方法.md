# 生命周期方法更迭

```
v17即将 删除componentWillMount，componentWillReceiveProps和componentWillUpdate
https://segmentfault.com/a/1190000014456811?utm_source=channel-hottest  
```

> getDerivedStateFromProps -> componentWillReceiveProps  
新的静态 getDerivedStateFromProps生命周期方法,在组件实例化以及接收新props后调用。  
它可以返回一个对象来更新state，或者返回null来表示新的props不需要任何state更新。    

```js
class Example extends React.Component {
  static getDerivedStateFromProps(nextProps, prevState) {
    // ...
  }
}
```

> getSnapshotBeforeUpdate -> componentWillUpdate  
```js
class Example extends React.Component {
  getSnapshotBeforeUpdate(prevProps, prevState) {
    // ...
  }
}
```

> 基于props更新state  
```js
// 之前
class ExampleComponent extends React.Component {
  state = {
    isScrollingDown: false,
  };

  componentWillReceiveProps(nextProps) {
    if (this.props.currentRow !== nextProps.currentRow) {
      this.setState({
        isScrollingDown:
          nextProps.currentRow > this.props.currentRow,
      });
    }
  }
}
// 新API代替之后
class ExampleComponent extends React.Component {
  // Initialize state in constructor,
  // Or with a property initializer.
  state = {
    isScrollingDown: false,
    lastRow: null,
  };

  static getDerivedStateFromProps(nextProps, prevState) {
    if (nextProps.currentRow !== prevState.lastRow) {
      return {
        isScrollingDown:
          nextProps.currentRow > prevState.lastRow,
        lastRow: nextProps.currentRow,
      };
    }

    // Return null to indicate no change to state.
    return null;
  }
}
```
**version:16.3.0之后的版本 提示 componentWillMount componentWillReceiveProps 即将过期**


## 错误边界 (Error Boundaries)

```js
componentDidCatch(error, {componentStack}) {
  this.setState({
    error,
    componentStack,
  });
}
// 只能 检测生命周期方法异常
```

```js
static getDerivedStateFromError(error) {
  // Update state so the next render will show the fallback UI.
  return { hasError: true };
}
// 当抛出错误后，
// 请使用 static getDerivedStateFromError() 渲染备用 UI ，
// 使用 componentDidCatch() 打印错误信息。
```
## new render return types(render 方法优化)

render 支持返回数组、字符串。早期为了符合React 的component tree 和diff结构设计顶层必须包裹为一个单节点。后果就是嵌套太深
```js
// 返回数组:
render() {
  return [
    "注:",
    <p key="t-1">产品说明一</h2>,
    <p key="t-2">产品说明二</h2>,
  ];
}
// 返回字符串:
render() {
  return 'app'
}
```

## 服务端渲染
服务端渲染 只会执行 componentswillmount 因此会存在内存泄漏 ，卸载事件不能执行。所以应该在didmount中执行
